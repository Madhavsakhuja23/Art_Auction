<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Register</title>
  <link rel="stylesheet" href="sign_up.css" />
</head>

<body>
  <div id="outer" class="fade-in">
    <p id="cross"><a href="index.html">&cross;</a></p>
    <h2>Register</h2>
    <form method="post" id="registerForm">
      <input type="text" name="Fn" id="fn" placeholder="First Name" required />
      <div id="name_criteria"></div>
      <input type="text" name="ln" id="ln" placeholder="Last Name" required />
      <input type="email" name="email" id="email" placeholder="Email" required />
      <div id="email_criteria"></div>
      <input type="text" name="phone_no" id="phone_no" placeholder="Phone Number" required minlength="10"
        maxlength="10" />
      <input type="password" name="pwd" id="pwd" placeholder="Password" required />
      <div id="pwdcriteria"></div>
      <input type="password" name="cpwd" id="cpwd" placeholder="Confirm Password" required />
      <div class="text-captcha">
    <span id="captcha"></span>
    <button  type="button" onclick="generateCaptcha()">↻ Refresh</button>
    <br><br>
    <input type="text" id="userInput" placeholder="Enter captcha here">
  </div>

  <!-- Fake reCAPTCHA style -->
  <div class="captcha-box">
    <div id="customCheck" class="checkbox" onclick="toggleCheck(event)"></div>
    <div class="captcha-text">I'm not a robot</div>
    <div class="recaptcha-logo">
      <img src="https://www.gstatic.com/recaptcha/api2/logo_48.png" alt="reCAPTCHA">
    </div>
  </div>
  <div class="recaptcha-footer">
    <span>reCAPTCHA</span>
    <a href="#">Privacy</a>
    <a href="#">Terms</a>
  </div>
  <p id="result"></p>
      <input type="submit" value="Register" />
      <p class="login-link">Already have an account? <a href="login.html">Login</a></p>
    </form>
  </div>

  <script>
    function pwd_check() {
      const pwd = document.getElementById("pwd").value;
      const cpwd = document.getElementById("cpwd").value;
      const feedback = document.getElementById("pwdcriteria");

      feedback.style.display = "block";
      // feedback.style.padding = "8px";
      // feedback.style.borderRadius = "6px";
      // feedback.style.fontSize = "14px";
      feedback.style.backgroundColor = "transparent";


      if (pwd.length < 10) {
        feedback.innerHTML = "Password must be at least 10 characters long.";
        feedback.style.color = "#333";
        return false;
      }
      const hasUpperCase = /[A-Z]/.test(pwd);
      const hasNumber = /\d/.test(pwd);

      if (!hasUpperCase || !hasNumber) {
        feedback.innerHTML = " Password must include a uppercase and a number.";
        feedback.style.color = " #333";
        return false;
      }


      if (pwd !== cpwd) {
        feedback.innerHTML = "Passwords do not match.";
        feedback.style.color = "#333";
        return false;
      }

      feedback.innerHTML = "Password is strong and matches.";
      feedback.style.color = "green";
      return true;


    }
  async function emailValidate() {
    try{
    let key = "ema_live_myHyeXrksaI52K3z9nDBs1z46RYEjNL9W4CaMKRd";
    let email = document.getElementById("email").value;
    let url = `https://api.emailvalidation.io/v1/info?apikey=${key}&email=${email}`;
    let res = await fetch(url);
    let result = await res.json();

    const regex = /^[a-zA-Z0-9._%+-]+@(gmail\.com|yahoo\.com)$/;

    // Check allowed domains
    if (!regex.test(email)) {
      document.getElementById("email_criteria").style.display = "block";
      document.getElementById("email_criteria").innerText =
        "Email must end with @gmail.com or @yahoo.com.";
      return false;
    }

    // Check if already stored
    let le = localStorage.getItem("email");
    if (le === email) {
      document.getElementById("email_criteria").style.display = "block";
      document.getElementById("email_criteria").innerText =
        "Already have an existing account with this Email.";
      return false;
    }

    // API validation check
    if (result.state === "deliverable") {
      document.getElementById("email_criteria").style.display = "none"; // hide error
      return true;
    } else {
      document.getElementById("email_criteria").style.display = "block";
      document.getElementById("email_criteria").innerText =
        "Enter the valid email address.";
      return false;
    }
  }
  catch (err) {
    document.getElementById("email_criteria").style.display = "block";
    document.getElementById("email_criteria").innerText = "Email validation failed. Try again.";
    return false;
  }
}

    function user() {
      let first_name = document.getElementById("fn").value.trim();
      const hasUpperCase = /[A-Z]/.test(first_name);
      const hasLower = /[a-z]/.test(first_name);
      if (!hasUpperCase && !hasLower) {
        document.getElementById("name_criteria").style.display = "block";
        document.getElementById("name_criteria")
          .innerText = "Name must contain both uppercase and lowercase letters."
        return false;
      }
      return true;
    }

    let captchaText = "";
  let isChecked = false;

  function toggleCheck(e) {
    e.stopPropagation();
    const box = document.getElementById("customCheck");
    isChecked = !isChecked;
    if (isChecked) {
      box.classList.add("checked");
      box.innerHTML = "✔";
    } else {
      box.classList.remove("checked");
      box.innerHTML = "";
    }
  }

  function generateCaptcha() {
    const chars = "ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnpqrstuvwxyz23456789"; 
    captchaText = "";
    for (let i = 0; i < 6; i++) {
      const randIndex = Math.floor(Math.random() * chars.length);
      captchaText += chars[randIndex];
    }
    document.getElementById("captcha").innerText = captchaText.split("").join(" ");
  }
  function verifyAll() {
    const result = document.getElementById("result");
    const userValue = document.getElementById("userInput").value.trim();

    if (!isChecked) {
      result.style.color = "crimson";
      result.innerText = "⚠️ Please confirm you are not a robot!";
      return false;
    }

    if (userValue === captchaText) {
      result.style.color = "green";
      result.innerText = "✅ Success! Captcha verified.";
    } else {
      result.style.color = "red";
      result.innerText = "❌ Wrong captcha. Try again!";
      generateCaptcha();
      return false;
    }
    return true;
  }

document.getElementById("registerForm").addEventListener("submit", async function (e) {
  e.preventDefault();
  const pwdValid = pwd_check();
  const emailValid = await emailValidate();
  const userValid = user();
  const verifycaptcha_Robot = verifyAll();
  if (pwdValid && emailValid && userValid && verifycaptcha_Robot) {
    localStorage.setItem("email", document.getElementById("email").value);
    localStorage.setItem("password", document.getElementById("pwd").value);
    localStorage.setItem("Firstname", document.getElementById("fn").value);

    window.location.href = "login.html";
  }
  return false;
});
  </script>
</body>


</html>
